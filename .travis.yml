---
dist: trusty
language: rust
rust:
  - stable
  - beta
  - nightly
sudo: required
services:
  - docker
  - postgresql
cache:
  apt: true
  cargo: true
before_script:
  - export PATH=$HOME/.local/bin:$PATH
  - export PATH=$HOME/Library/Python/2.7/bin:$PATH
  - sudo add-apt-repository -y ppa:0k53d-karl-f830m/openssl
  - sudo apt-get update -qq
  - sudo apt-get install -qq libssl-dev libelf-dev libdw-dev cmake gcc binutils-dev libiberty-dev
  - ./.ci/install_cargo_web
  - psql -c "CREATE DATABASE database;" -U postgres
  - psql -c "CREATE USER username WITH PASSWORD 'password';" -U postgres
  - cargo install diesel_cli --no-default-features --features "postgres"
  - diesel migration run --database-url postgres://username:password@localhost/database
script:
  - export CARGO_TARGET_DIR=`pwd`/target
  - cargo build --release
  - cargo build -p webapp-backend --release
  - cargo web build -p webapp-frontend --target wasm32-unknown-emscripten --release
  - cargo test -p webapp-backend
os:
  - linux
env:
  global:
    - OPENSSL_VERSION=openssl-1.0.2
notifications:
  email:
    on_success: never
